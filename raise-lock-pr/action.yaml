name: Update Gradle lockfiles and raise PR
description: If any lockfiles are outdated, updates them and raises a pull request
inputs:
  token:
    description: 'Github auth token with permissions to raise a PR'
    required: true
  post-process:
    description: 'shell command to run after updating lock files. Can be used to cleanup locks'
    default: 'git status'
runs:
  using: composite
  steps:
    - name: Update lockfiles
      uses: hypertrace/github-actions/gradle@main
      with:
        args: resolveAndLockAll --write-locks --refresh-dependencies
    - name: Post process
      shell: bash
      run: ${{ inputs.args }}
    - name: Create Pull Request
      uses: peter-evans/create-pull-request@v5
      with:
        title: Update gradle locks (Automated)
        body: |
          # Autogenerated gradle lock updates
        commit-message: Update gradle locks
        delete-branch: true
        branch-suffix: timestamp
        token: ${{ inputs.token }}
